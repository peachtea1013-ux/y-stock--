diff --git a/index.html b/index.html
index 560b18c5c3e36151ae06260c228e4053b14974db..7494fa13983f1c35bd55cbc8c450399fddeb6036 100644
--- a/index.html
+++ b/index.html
@@ -1,263 +1,1202 @@
-<!DOCTYPE html>
-<html lang="ja">
-<head>
-    <meta charset="UTF-8">
-    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
-    <title>ãƒã‚¤åœ¨åº«ç®¡ç†ãƒ—ãƒ­</title>
-    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
-    <style>
-        :root { --primary: #007bff; --danger: #dc3545; --success: #28a745; --warning: #ffc107; --dark: #343a40; }
-        body { font-family: sans-serif; margin: 0; padding-bottom: 80px; background: #f4f7f6; color: #333; font-size: 14px; }
-        
-        /* èªè¨¼å‰ã®ç”»é¢ã‚’éš ã™ */
-        #mainContent { display: none; }
-
-        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; border-top: 1px solid #ddd; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.1); }
-        .nav-item { flex: 1; padding: 15px 5px; text-align: center; font-size: 0.8rem; color: #666; border-top: 3px solid transparent; }
-        .nav-item.active { color: var(--primary); font-weight: bold; border-top-color: var(--primary); }
-
-        .page { display: none; padding: 15px; animation: fadeIn 0.2s; }
-        .page.active { display: block; }
-        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
-
-        .card { background: white; border-radius: 12px; padding: 15px; margin-bottom: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
-        .flex-row { display: flex; justify-content: space-between; align-items: center; }
-        .input-std { width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; margin-bottom: 10px; font-size: 16px; }
-        
-        .alert-box { background: #fff5f5; border: 1px solid #feb2b2; }
-        button { border: none; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.1s; }
-        button:active { transform: scale(0.95); opacity: 0.8; }
-        .btn-action { padding: 12px 5px; color: white; flex: 1; font-size: 0.9rem; }
-        .btn-use { background: var(--danger); }
-        .btn-in { background: var(--success); }
-        .btn-req { background: var(--warning); color: #333; }
-        .btn-main { background: var(--primary); color: white; width: 100%; padding: 15px; font-size: 1rem; }
-
-        #inventoryOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: white; z-index: 200; overflow-y: auto; display: none; }
-        .category-badge { font-size: 0.75rem; background: #eef2f7; padding: 3px 10px; border-radius: 12px; color: #555; }
-    </style>
-</head>
-<body>
-
-    <div id="mainContent">
-        <div id="page-stock" class="page active">
-            <div style="background:var(--dark); color:white; padding:15px; border-radius:12px; text-align:center; margin-bottom:15px;">
-                <small>åœ¨åº«ç·è³‡ç”£</small><br>
-                <span style="font-size:1.6rem; font-weight:bold;">Â¥ <span id="totalMoneyDisplay">0</span></span>
-            </div>
-            <div style="display:flex; gap:8px; margin-bottom:15px;">
-                <input type="text" id="searchInput" class="input-std" style="flex:2; margin-bottom:0;" placeholder="ğŸ” æ¤œç´¢..." oninput="render()">
-                <select id="catFilter" class="input-std" style="flex:1; margin-bottom:0;" onchange="render()"></select>
-            </div>
-            <div id="shortageArea"></div>
-            <div id="stockList"></div>
-        </div>
-
-        <div id="page-history" class="page">
-            <h3>æ´»å‹•å±¥æ­´</h3>
-            <div id="historyList"></div>
-        </div>
-
-        <div id="page-chart" class="page">
-            <h3>æœˆé–“ä½¿ç”¨ãƒˆãƒ¬ãƒ³ãƒ‰</h3>
-            <canvas id="usageChart" width="400" height="300"></canvas>
-        </div>
-
-        <div id="page-manage" class="page">
-            <h3>ç®¡ç†ãƒ»ãƒ„ãƒ¼ãƒ«</h3>
-            <button class="btn-main" style="background:#6f42c1; margin-bottom:20px;" onclick="openInventoryMode()">ğŸ“¦ æ£šå¸ã—ã‚’é–‹å§‹ã™ã‚‹</button>
-
-            <div class="card">
-                <h4 style="margin:0 0 12px 0;">æ–°è¦ã‚¢ã‚¤ãƒ†ãƒ ç™»éŒ²</h4>
-                <input type="text" id="newName" class="input-std" placeholder="å•†å“å" list="list-names">
-                <div style="display:flex; gap:8px;">
-                    <input type="text" id="newMaker" class="input-std" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼" list="list-makers">
-                    <input type="text" id="newModel" class="input-std" placeholder="å‹å¼" list="list-models">
-                </div>
-                <div style="display:flex; gap:8px;">
-                    <input type="text" id="newCat" class="input-std" placeholder="ã‚«ãƒ†ã‚´ãƒª" list="list-cats">
-                    <input type="number" id="newPrice" class="input-std" placeholder="å˜ä¾¡(Â¥)" inputmode="numeric">
-                </div>
-                <input type="number" id="newMin" class="input-std" placeholder="æœ€ä½åœ¨åº«é€šçŸ¥ãƒ©ã‚¤ãƒ³" inputmode="numeric">
-                <button class="btn-main" onclick="addItem()">ãƒã‚¹ã‚¿ãƒ¼ã«è¿½åŠ </button>
-            </div>
-
-            <div class="card" style="background:#f0fff4; border:1px solid #c6f6d5;">
-                <h4 style="margin:0 0 10px 0;">ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</h4>
-                <button onclick="copyAllToExcel()" style="background:#2f855a; color:white; width:100%; padding:12px;">Excelä¸€æ‹¬ã‚³ãƒ”ãƒ¼</button>
-            </div>
-
-            <h4>ç™»éŒ²æ¸ˆã¿ãƒã‚¹ã‚¿ãƒ¼</h4>
-            <div id="editList"></div>
-        </div>
-
-        <div id="inventoryOverlay">
-            <div style="padding:20px;">
-                <div class="flex-row">
-                    <h2>å®Ÿåœ¨åº«ã®ç¢ºèª</h2>
-                    <button onclick="closeInventoryMode()" style="background:#eee; padding:8px 15px;">æˆ»ã‚‹</button>
-                </div>
-                <div id="inventoryList"></div>
-                <button class="btn-main" style="background:var(--success); margin-top:20px;" onclick="finishInventory()">æ£šå¸ã—ã‚’ç¢ºå®š</button>
-            </div>
-        </div>
-
-        <nav class="bottom-nav">
-            <div class="nav-item active" onclick="showPage('stock')">åœ¨åº«</div>
-            <div class="nav-item" onclick="showPage('history')">å±¥æ­´</div>
-            <div class="nav-item" onclick="showPage('chart')">åˆ†æ</div>
-            <div class="nav-item" onclick="showPage('manage')">ç®¡ç†</div>
-        </nav>
-    </div>
-
-    <datalist id="list-names"></datalist>
-    <datalist id="list-makers"></datalist>
-    <datalist id="list-models"></datalist>
-    <datalist id="list-cats"></datalist>
-
-<script>
-    // --- ğŸ”‘ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š ---
-    const APP_PASS = "1234"; // â˜…ã“ã“ã‚’å¥½ããªãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã«å¤‰æ›´ã—ã¦ãã ã•ã„
-
-    function checkAuth() {
-        const input = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
-        if (input === APP_PASS) {
-            document.getElementById('mainContent').style.display = 'block';
-            render();
-        } else {
-            alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã‚’æ‹’å¦ã—ã¾ã—ãŸã€‚");
-            document.body.innerHTML = "<h2 style='text-align:center;margin-top:50px;'>èªè¨¼ãŒå¿…è¦ã§ã™ã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚</h2>";
-        }
-    }
-
-    // èµ·å‹•æ™‚ã«èªè¨¼ã‚’å®Ÿè¡Œ
-    window.onload = checkAuth;
-
-    // --- ğŸ“¦ åœ¨åº«ç®¡ç†ãƒ­ã‚¸ãƒƒã‚¯ ---
-    let items = JSON.parse(localStorage.getItem('myStockV3_items')) || [];
-    let logs = JSON.parse(localStorage.getItem('myStockV3_logs')) || [];
-
-    function showPage(pageId) {
-        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
-        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
-        document.getElementById('page-' + pageId).classList.add('active');
-        event.currentTarget.classList.add('active');
-        if(pageId === 'chart') updateChart();
-        render();
-    }
-
-    function save() {
-        localStorage.setItem('myStockV3_items', JSON.stringify(items));
-        localStorage.setItem('myStockV3_logs', JSON.stringify(logs));
-        render();
-    }
-
-    function addItem() {
-        const ids = ['newName', 'newMaker', 'newModel', 'newCat', 'newPrice', 'newMin'];
-        const [n, mk, md, c, p, mn] = ids.map(id => document.getElementById(id).value);
-        if(!n) return alert("åå‰ã¯å¿…é ˆã§ã™");
-        items.push({ id: Date.now(), name: n, maker: mk||'-', model: md||'-', category: c||'æœªåˆ†é¡', price: parseInt(p)||0, minStock: parseInt(mn)||0, count: 0 });
-        ids.forEach(id => document.getElementById(id).value = '');
-        save();
-    }
-
-    function doAction(id, type, multiplier) {
-        const input = document.getElementById(`qty-${id}`);
-        const val = parseInt(input.value) || 1;
-        const item = items.find(i => i.id === id);
-        if(type !== 'ä¾é ¼') item.count = Math.max(0, item.count + (val * multiplier));
-        logs.unshift({ date: new Date().toLocaleString('ja-JP'), month: new Date().toISOString().slice(0,7), name: item.name, type: type, qty: val, price: item.price });
-        if(logs.length > 200) logs.pop();
-        input.value = '';
-        save();
-    }
-
-    function render() {
-        const search = document.getElementById('searchInput').value.toLowerCase();
-        const filter = document.getElementById('catFilter').value || 'all';
-        
-        const updateDL = (id, key) => {
-            const vals = [...new Set(items.map(i => i[key]))].filter(v => v && v !== '-');
-            document.getElementById(id).innerHTML = vals.map(v => `<option value="${v}">`).join('');
-        };
-        ['list-names','list-makers','list-models','list-cats'].forEach((id,idx)=>updateDL(id,['name','maker','model','category'][idx]));
-
-        const cats = [...new Set(items.map(i => i.category))];
-        document.getElementById('catFilter').innerHTML = '<option value="all">å…¨ã‚«ãƒ†ã‚´ãƒª</option>' + cats.map(c => `<option value="${c}" ${filter===c?'selected':''}>${c}</option>`).join('');
-
-        document.getElementById('totalMoneyDisplay').innerText = items.reduce((s, i) => s + (i.count * i.price), 0).toLocaleString();
-
-        const shorts = items.filter(i => i.count <= i.minStock);
-        document.getElementById('shortageArea').innerHTML = shorts.length ? `<div class="card alert-box"><div style="color:var(--danger);font-weight:bold;margin-bottom:5px;">âš ï¸ è¦è£œå……</div>${shorts.map(s => `<small>${s.name}</small>`).join(', ')}</div>` : '';
-
-        const filtered = items.filter(i => {
-            const mS = i.name.toLowerCase().includes(search) || i.maker.toLowerCase().includes(search) || i.model.toLowerCase().includes(search);
-            const mC = filter === 'all' || i.category === filter;
-            return mS && mC;
-        });
-
-        document.getElementById('stockList').innerHTML = filtered.map(i => `
-            <div class="card ${i.count <= i.minStock ? 'alert-box' : ''}">
-                <div class="flex-row">
-                    <div style="flex:1;">
-                        <span class="category-badge">${i.category}</span>
-                        <div style="font-size:0.75rem; color:#888; margin:4px 0;">${i.maker} / ${i.model}</div>
-                        <strong style="font-size:1.1rem;">${i.name}</strong>
-                    </div>
-                    <div style="text-align:right;">
-                        <div style="font-size:1.6rem; font-weight:bold;">${i.count}</div>
-                        <div style="font-size:0.75rem; color:var(--primary);">Â¥${(i.count * i.price).toLocaleString()}</div>
-                    </div>
-                </div>
-                <div style="display:flex; gap:8px; margin-top:12px;">
-                    <input type="number" id="qty-${i.id}" class="input-std" style="flex:1; margin:0; text-align:center;" placeholder="1" inputmode="numeric">
-                    <button class="btn-action btn-use" onclick="doAction(${i.id}, 'ä½¿ç”¨', -1)">ä½¿ç”¨</button>
-                    <button class="btn-action btn-in" onclick="doAction(${i.id}, 'ç´å…¥', 1)">ç´å…¥</button>
-                    <button class="btn-action btn-req" onclick="doAction(${i.id}, 'ä¾é ¼', 0)">ä¾é ¼</button>
-                </div>
-            </div>
-        `).join('');
-
-        document.getElementById('historyList').innerHTML = logs.map(l => `<div style="padding:10px; border-bottom:1px solid #eee; font-size:0.85rem;">${l.date.slice(5)} | <strong>${l.name}</strong> | ${l.type}(${l.qty})</div>`).join('');
-        document.getElementById('editList').innerHTML = items.map(i => `<div class="card flex-row"><span>${i.name}</span><button onclick="if(confirm('å‰Šé™¤ï¼Ÿ')){items=items.filter(x=>x.id!=${i.id});save();}" style="color:red; background:none;">å‰Šé™¤</button></div>`).join('');
-    }
-
-    function openInventoryMode() {
-        document.getElementById('inventoryOverlay').style.display = 'block';
-        document.getElementById('inventoryList').innerHTML = items.map(i => `
-            <div class="card flex-row">
-                <span><strong>${i.name}</strong><br><small>${i.model}</small></span>
-                <span>ç¾ç‰©: <input type="number" id="inv-${i.id}" value="${i.count}" style="width:70px; padding:10px;" inputmode="numeric"></span>
-            </div>`).join('');
-    }
-    function closeInventoryMode() { document.getElementById('inventoryOverlay').style.display = 'none'; }
-    function finishInventory() {
-        items.forEach(i => {
-            const nV = parseInt(document.getElementById(`inv-${i.id}`).value) || 0;
-            if(i.count !== nV) {
-                logs.unshift({ date: new Date().toLocaleString('ja-JP'), month: new Date().toISOString().slice(0,7), name: i.name, type: 'æ£šå¸èª¿æ•´', qty: nV - i.count, price: i.price });
-                i.count = nV;
-            }
-        });
-        save(); closeInventoryMode(); alert("æ£šå¸å®Œäº†");
-    }
-
-    let chartObj;
-    function updateChart() {
-        const ctx = document.getElementById('usageChart').getContext('2d');
-        const mths = [...new Set(logs.map(l => l.month))].sort().slice(-6);
-        const data = mths.map(m => logs.filter(l => l.month === m && l.type === 'ä½¿ç”¨').reduce((s, l) => s + l.qty, 0));
-        if(chartObj) chartObj.destroy();
-        chartObj = new Chart(ctx, { type: 'bar', data: { labels: mths, datasets: [{ label: 'æœˆé–“ä½¿ç”¨é‡', data: data, backgroundColor: '#007bff' }] } });
-    }
-
-    function copyAllToExcel() {
-        let t = "ã€ç¾åœ¨åœ¨åº«ã€‘\nå•†å“å\tãƒ¡ãƒ¼ã‚«ãƒ¼\tå‹å¼\tã‚«ãƒ†ã‚´ãƒª\tåœ¨åº«æ•°\tå˜ä¾¡\tå°è¨ˆ\n";
-        items.forEach(i => t += `${i.name}\t${i.maker}\t${i.model}\t${i.category}\t${i.count}\t${i.price}\t${i.count*i.price}\n`);
-        t += "\nã€å±¥æ­´ã€‘\næ—¥æ™‚\tå•†å“å\tç¨®åˆ¥\tæ•°é‡\té‡‘é¡\n";
-        logs.forEach(l => t += `${l.date}\t${l.name}\t${l.type}\t${l.qty}\t${l.qty*l.price}\n`);
-        navigator.clipboard.writeText(t).then(() => alert("ä¸€æ‹¬ã‚³ãƒ”ãƒ¼æˆåŠŸï¼"));
-    }
-</script>
-</body>
-</html>
+<!DOCTYPE html>
+<html lang="ja">
+<head>
+  <meta charset="UTF-8">
+  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
+  <meta name="theme-color" content="#0f172a">
+  <title>åœ¨åº«ç®¡ç†ãƒ„ãƒ¼ãƒ«</title>
+  <style>
+    :root {
+      --primary: #2563eb;
+      --danger: #dc2626;
+      --warning: #f59e0b;
+      --success: #16a34a;
+      --dark: #0f172a;
+      --gray: #64748b;
+      --bg: #f8fafc;
+    }
+
+    * { box-sizing: border-box; }
+    body {
+      margin: 0;
+      font-family: "Hiragino Kaku Gothic ProN", "Yu Gothic", "Meiryo", sans-serif;
+      background: var(--bg);
+      color: #0f172a;
+      padding-bottom: 84px;
+      font-size: 15px;
+    }
+    h1, h2, h3, h4 { margin: 0 0 12px 0; }
+    .page { display: none; padding: 16px; }
+    .page.active { display: block; }
+    .card {
+      background: #fff;
+      border-radius: 14px;
+      padding: 14px;
+      margin-bottom: 12px;
+      box-shadow: 0 6px 16px rgba(15, 23, 42, 0.08);
+    }
+    .badge { display: inline-block; padding: 3px 10px; border-radius: 999px; font-size: 12px; color: #fff; }
+    .row { display: flex; gap: 8px; align-items: center; }
+    .row-between { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
+    .input {
+      width: 100%;
+      padding: 12px;
+      border-radius: 10px;
+      border: 1px solid #e2e8f0;
+      font-size: 16px;
+      background: #fff;
+    }
+    .input.small { padding: 10px; font-size: 14px; }
+    .input.inline { width: auto; }
+    .btn {
+      border: none;
+      border-radius: 10px;
+      padding: 12px;
+      font-size: 14px;
+      font-weight: 700;
+      cursor: pointer;
+    }
+    .btn.primary { background: var(--primary); color: #fff; }
+    .btn.success { background: var(--success); color: #fff; }
+    .btn.danger { background: var(--danger); color: #fff; }
+    .btn.warning { background: var(--warning); color: #fff; }
+    .btn.ghost { background: transparent; border: 1px solid #cbd5f5; color: #1e293b; }
+    .btn.block { width: 100%; }
+    .tag { font-size: 12px; color: var(--gray); }
+    .status-text { font-size: 12px; font-weight: 700; }
+    .list-item { border-bottom: 1px solid #e2e8f0; padding: 10px 0; }
+    .list-item:last-child { border-bottom: none; }
+
+    .bottom-nav {
+      position: fixed;
+      bottom: 0;
+      left: 0;
+      width: 100%;
+      background: #fff;
+      border-top: 1px solid #e2e8f0;
+      display: flex;
+      z-index: 50;
+    }
+    .nav-item {
+      flex: 1;
+      text-align: center;
+      padding: 12px 6px;
+      font-size: 12px;
+      color: #475569;
+      border-top: 3px solid transparent;
+    }
+    .nav-item.active {
+      color: var(--primary);
+      border-top-color: var(--primary);
+      font-weight: 700;
+    }
+
+    .alert-shortage { background: #fff1f2; border: 1px solid #fecdd3; }
+    .alert-order { background: #fff7ed; border: 1px solid #fed7aa; }
+
+    .category-chip { font-size: 12px; font-weight: 700; padding: 3px 10px; border-radius: 999px; color: #fff; }
+
+    .modal {
+      position: fixed;
+      inset: 0;
+      background: rgba(15, 23, 42, 0.6);
+      display: none;
+      align-items: center;
+      justify-content: center;
+      padding: 20px;
+      z-index: 200;
+    }
+    .modal.active { display: flex; }
+    .modal-content {
+      background: #fff;
+      width: 100%;
+      max-width: 560px;
+      border-radius: 16px;
+      padding: 16px;
+      max-height: 85vh;
+      overflow-y: auto;
+    }
+    body.modal-open { overflow: hidden; }
+    body.modal-open .bottom-nav { display: none; }
+
+    .section-title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
+    .muted { color: #64748b; font-size: 12px; }
+
+    .calendar {
+      display: grid;
+      grid-template-columns: repeat(7, 1fr);
+      gap: 4px;
+      text-align: center;
+    }
+    .calendar .day {
+      padding: 8px 2px;
+      border-radius: 8px;
+      background: #fff;
+      border: 1px solid #e2e8f0;
+      font-size: 12px;
+      min-height: 54px;
+      display: flex;
+      flex-direction: column;
+      justify-content: center;
+      gap: 4px;
+    }
+    .calendar .day.has-event { border: 2px solid var(--primary); }
+    .calendar .day.selected { background: #dbeafe; border-color: var(--primary); }
+    .calendar .day-header { font-weight: 700; font-size: 12px; color: #64748b; }
+
+    .inventory-row { display: flex; justify-content: space-between; align-items: center; gap: 8px; }
+    .inventory-row input { width: 90px; }
+
+    .history-table { width: 100%; border-collapse: collapse; font-size: 12px; }
+    .history-table th, .history-table td { border-bottom: 1px solid #e2e8f0; padding: 8px; text-align: left; }
+    .history-table th { background: #f1f5f9; position: sticky; top: 0; z-index: 1; }
+
+    .info-box { background: #f1f5f9; border-radius: 12px; padding: 12px; }
+    .hidden { display: none; }
+  </style>
+</head>
+<body>
+  <main>
+    <section id="page-stock" class="page active">
+      <div class="card" style="background:var(--dark); color:#fff;">
+        <div class="tag">åœ¨åº«ç·è³‡ç”£</div>
+        <div style="font-size:28px; font-weight:700;">Â¥ <span id="totalAsset">0</span></div>
+      </div>
+
+      <div class="card">
+        <div class="row" style="gap:12px;">
+          <input id="stockSearch" class="input" type="text" placeholder="ğŸ” å•†å“åã§æ¤œç´¢" oninput="renderStockList()">
+          <select id="stockCategoryFilter" class="input" onchange="renderStockList()"></select>
+        </div>
+      </div>
+
+      <div id="shortageNotice"></div>
+      <div id="stockList"></div>
+    </section>
+
+    <section id="page-history" class="page">
+      <div class="card">
+        <h3>æ“ä½œå±¥æ­´ï¼ˆæœ€æ–°1000ä»¶ï¼‰</h3>
+        <div class="row" style="gap:12px;">
+          <input id="historySearch" class="input" type="text" placeholder="å•†å“åã§æ¤œç´¢" oninput="renderHistory()">
+          <select id="historyCategoryFilter" class="input" onchange="renderHistory()"></select>
+        </div>
+      </div>
+      <div class="card" style="padding:0;">
+        <table class="history-table">
+          <thead>
+            <tr>
+              <th>æ—¥æ™‚</th>
+              <th>å•†å“å</th>
+              <th>ã‚³ãƒ¼ãƒ‰</th>
+              <th>ã‚«ãƒ†ã‚´ãƒª</th>
+              <th>ç¨®åˆ¥</th>
+              <th>æ•°é‡</th>
+              <th>æ“ä½œå¾Œåœ¨åº«</th>
+              <th>ä½¿ç”¨ç†ç”±</th>
+              <th>çªç™ºç†ç”±</th>
+              <th></th>
+            </tr>
+          </thead>
+          <tbody id="historyList"></tbody>
+        </table>
+      </div>
+    </section>
+
+    <section id="page-master" class="page">
+      <div class="card">
+        <h3>å•†å“ãƒã‚¹ã‚¿ç®¡ç†</h3>
+        <button class="btn primary block" onclick="openModal('itemModal')">ï¼‹ æ–°è¦å•†å“ã‚’ç™»éŒ²</button>
+      </div>
+
+      <div class="card">
+        <h4>CSVé€£æº</h4>
+        <div class="row" style="flex-wrap:wrap;">
+          <button class="btn success" onclick="exportItemsCSV()">å•†å“ãƒã‚¹ã‚¿CSVå‡ºåŠ›</button>
+          <button class="btn success" onclick="exportHistoryCSV()">æ“ä½œå±¥æ­´CSVå‡ºåŠ›</button>
+        </div>
+        <div style="margin-top:12px;">
+          <label class="btn ghost block" for="importCSV">CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆå•†å“ãƒã‚¹ã‚¿ï¼‰</label>
+          <input id="importCSV" type="file" accept=".csv" class="hidden" onchange="importItemsCSV(event)">
+        </div>
+      </div>
+
+      <div class="card">
+        <div class="row-between">
+          <h4>æ£šå¸</h4>
+          <button class="btn primary" onclick="openInventory()">æ£šå¸é–‹å§‹</button>
+        </div>
+        <div class="muted">é€”ä¸­çµ‚äº†ãƒ»å†é–‹å¯èƒ½ã€‚ç¢ºå®šã™ã‚‹ã¨åœ¨åº«ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚</div>
+      </div>
+
+      <div id="masterList"></div>
+    </section>
+
+    <section id="page-calendar" class="page">
+      <div class="card">
+        <h3>äº¤æ›å‘¨æœŸãƒ»ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼</h3>
+        <div class="row-between">
+          <button class="btn ghost" onclick="changeMonth(-1)">å‰æœˆ</button>
+          <div id="calendarTitle" style="font-weight:700;"></div>
+          <button class="btn ghost" onclick="changeMonth(1)">æ¬¡æœˆ</button>
+        </div>
+      </div>
+      <div class="card" style="display:grid; grid-template-rows: 2fr 1fr; gap:12px;">
+        <div>
+          <div class="calendar" id="calendarGrid"></div>
+        </div>
+        <div>
+          <div class="section-title">äº¤æ›äºˆå®šãƒªã‚¹ãƒˆ</div>
+          <div id="exchangeList" class="info-box"></div>
+        </div>
+      </div>
+    </section>
+  </main>
+
+  <nav class="bottom-nav">
+    <div class="nav-item active" onclick="showPage('stock', event)">åœ¨åº«æ“ä½œ</div>
+    <div class="nav-item" onclick="showPage('history', event)">å±¥æ­´</div>
+    <div class="nav-item" onclick="showPage('master', event)">ãƒã‚¹ã‚¿/æ£šå¸</div>
+    <div class="nav-item" onclick="showPage('calendar', event)">äº¤æ›å‘¨æœŸ</div>
+  </nav>
+
+  <datalist id="history-name"></datalist>
+  <datalist id="history-maker"></datalist>
+  <datalist id="history-model"></datalist>
+  <datalist id="history-category"></datalist>
+
+  <div id="useModal" class="modal">
+    <div class="modal-content">
+      <h3>ä½¿ç”¨ç†ç”±</h3>
+      <div class="row">
+        <select id="useReason" class="input" onchange="toggleSuddenReason()">
+          <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
+          <option value="å®šæœŸäº¤æ›">å®šæœŸäº¤æ›</option>
+          <option value="çªç™ºäº¤æ›">çªç™ºäº¤æ›</option>
+          <option value="ãã®ä»–">ãã®ä»–</option>
+        </select>
+      </div>
+      <div id="suddenReasonArea" class="hidden" style="margin-top:10px;">
+        <div class="section-title">çªç™ºäº¤æ›ç†ç”±</div>
+        <div class="row" style="flex-wrap:wrap;">
+          <button class="btn ghost" onclick="setSuddenReason('ç ´æ')">ç ´æ</button>
+          <button class="btn ghost" onclick="setSuddenReason('ç´›å¤±')">ç´›å¤±</button>
+          <button class="btn ghost" onclick="setSuddenReason('æ‘©è€—')">æ‘©è€—</button>
+          <button class="btn ghost" onclick="setSuddenReason('åŠ£åŒ–')">åŠ£åŒ–</button>
+        </div>
+        <input id="suddenReason" class="input" type="text" placeholder="çªç™ºç†ç”±" style="margin-top:8px;" readonly>
+      </div>
+      <textarea id="useNote" class="input" rows="3" placeholder="å‚™è€ƒ"></textarea>
+      <div class="row" style="margin-top:12px;">
+        <button class="btn ghost" onclick="closeModal('useModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
+        <button class="btn danger" onclick="confirmUse()">ä½¿ç”¨ç™»éŒ²</button>
+      </div>
+    </div>
+  </div>
+
+  <div id="orderModal" class="modal">
+    <div class="modal-content">
+      <h3>ç™ºæ³¨ä¾é ¼</h3>
+      <select id="orderStatus" class="input">
+        <option value="ä¾é ¼ä¸­">ä¾é ¼ä¸­</option>
+        <option value="å®Œäº†">å®Œäº†</option>
+      </select>
+      <input id="orderQty" class="input" type="number" inputmode="numeric" placeholder="ç™ºæ³¨æ•°é‡">
+      <input id="orderDate" class="input" type="date">
+      <input id="orderDue" class="input" type="date">
+      <textarea id="orderNote" class="input" rows="3" placeholder="å‚™è€ƒ"></textarea>
+      <div class="row" style="margin-top:12px;">
+        <button class="btn ghost" onclick="closeModal('orderModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
+        <button class="btn warning" onclick="saveOrderRequest()">ä¿å­˜</button>
+      </div>
+    </div>
+  </div>
+
+  <div id="itemModal" class="modal">
+    <div class="modal-content">
+      <h3>å•†å“ãƒã‚¹ã‚¿ç™»éŒ²</h3>
+      <input id="itemCode" class="input" type="text" placeholder="å•†å“ã‚³ãƒ¼ãƒ‰ï¼ˆé‡è¤‡ä¸å¯ï¼‰">
+      <input id="itemName" class="input" type="text" list="history-name" placeholder="å“å">
+      <div class="row">
+        <input id="itemMaker" class="input" type="text" list="history-maker" placeholder="ãƒ¡ãƒ¼ã‚«ãƒ¼">
+        <input id="itemModel" class="input" type="text" list="history-model" placeholder="å‹å¼ï¼ˆå“ç•ªï¼‰">
+      </div>
+      <input id="itemCategory" class="input" type="text" list="history-category" placeholder="ã‚«ãƒ†ã‚´ãƒªãƒ¼">
+      <div class="row">
+        <input id="itemMin" class="input" type="number" inputmode="numeric" placeholder="æœ€ä½åœ¨åº«æ•°">
+        <input id="itemStock" class="input" type="number" inputmode="numeric" placeholder="ç¾åœ¨åº«æ•°">
+      </div>
+      <div class="row">
+        <input id="itemPrice" class="input" type="number" inputmode="numeric" placeholder="é‡‘é¡">
+        <input id="itemLead" class="input" type="number" inputmode="numeric" placeholder="ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ï¼ˆæ—¥æ•°ï¼‰">
+      </div>
+      <div class="row">
+        <input id="itemCycle" class="input" type="number" inputmode="numeric" placeholder="äº¤æ›å‘¨æœŸï¼ˆæ—¥æ•°ï¼‰">
+        <input id="itemNotes" class="input" type="text" placeholder="å‚™è€ƒ">
+      </div>
+      <div class="row" style="margin-top:12px;">
+        <button class="btn ghost" onclick="closeModal('itemModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
+        <button class="btn primary" onclick="saveItem()">ç™»éŒ²</button>
+      </div>
+    </div>
+  </div>
+
+  <div id="inventoryModal" class="modal">
+    <div class="modal-content">
+      <div class="row-between">
+        <h3>æ£šå¸</h3>
+        <button class="btn ghost" onclick="closeModal('inventoryModal')">é–‰ã˜ã‚‹</button>
+      </div>
+      <div class="row" style="gap:8px; margin-bottom:12px;">
+        <label class="muted">ã‚«ãƒ†ã‚´ãƒªãƒ¼ä¸¦ã³æ›¿ãˆ</label>
+        <select id="inventorySort" class="input small" onchange="renderInventoryList()">
+          <option value="name">å“åé †</option>
+          <option value="category">ã‚«ãƒ†ã‚´ãƒªãƒ¼é †</option>
+        </select>
+      </div>
+      <div id="inventoryList"></div>
+      <button class="btn success block" onclick="confirmInventory()">æ£šå¸ç¢ºå®š</button>
+    </div>
+  </div>
+
+  <div id="historyEditModal" class="modal">
+    <div class="modal-content">
+      <h3>å±¥æ­´ç·¨é›†</h3>
+      <select id="editType" class="input">
+        <option value="ä½¿ç”¨">ä½¿ç”¨</option>
+        <option value="ç´å…¥">ç´å…¥</option>
+        <option value="æ£šå¸">æ£šå¸</option>
+        <option value="ä¿®æ­£">ä¿®æ­£</option>
+      </select>
+      <input id="editQty" class="input" type="number" inputmode="numeric" placeholder="æ•°é‡">
+      <input id="editAfter" class="input" type="number" inputmode="numeric" placeholder="æ“ä½œå¾Œåœ¨åº«æ•°">
+      <input id="editReason" class="input" type="text" placeholder="ä½¿ç”¨ç†ç”±">
+      <input id="editSudden" class="input" type="text" placeholder="çªç™ºäº¤æ›ç†ç”±">
+      <textarea id="editNote" class="input" rows="3" placeholder="å‚™è€ƒ"></textarea>
+      <div class="row" style="margin-top:12px;">
+        <button class="btn ghost" onclick="closeModal('historyEditModal')">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
+        <button class="btn primary" onclick="saveHistoryEdit()">æ›´æ–°</button>
+      </div>
+    </div>
+  </div>
+
+  <script>
+    const STORAGE_KEYS = {
+      items: 'inventory_items_v1',
+      logs: 'inventory_logs_v1',
+      history: 'inventory_input_history_v1',
+      inventoryDraft: 'inventory_draft_v1',
+      categoryColors: 'inventory_category_colors_v1'
+    };
+
+    const state = {
+      items: [],
+      logs: [],
+      history: { names: [], makers: [], models: [], categories: [] },
+      categoryColors: {},
+      selectedItemId: null,
+      selectedLogId: null,
+      inventoryDraft: {},
+      calendarMonth: new Date()
+    };
+
+    const COLOR_PALETTE = [
+      '#3b82f6', '#0ea5e9', '#22c55e', '#10b981', '#f97316',
+      '#f43f5e', '#a855f7', '#14b8a6', '#84cc16', '#eab308'
+    ];
+
+    const loadState = () => {
+      state.items = JSON.parse(localStorage.getItem(STORAGE_KEYS.items)) || [];
+      state.logs = JSON.parse(localStorage.getItem(STORAGE_KEYS.logs)) || [];
+      state.history = JSON.parse(localStorage.getItem(STORAGE_KEYS.history)) || state.history;
+      state.categoryColors = JSON.parse(localStorage.getItem(STORAGE_KEYS.categoryColors)) || {};
+      state.inventoryDraft = JSON.parse(localStorage.getItem(STORAGE_KEYS.inventoryDraft)) || {};
+    };
+
+    const saveState = () => {
+      localStorage.setItem(STORAGE_KEYS.items, JSON.stringify(state.items));
+      localStorage.setItem(STORAGE_KEYS.logs, JSON.stringify(state.logs.slice(0, 1000)));
+      localStorage.setItem(STORAGE_KEYS.history, JSON.stringify(state.history));
+      localStorage.setItem(STORAGE_KEYS.categoryColors, JSON.stringify(state.categoryColors));
+      localStorage.setItem(STORAGE_KEYS.inventoryDraft, JSON.stringify(state.inventoryDraft));
+    };
+
+    const showPage = (pageId, event) => {
+      document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
+      document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
+      document.getElementById(`page-${pageId}`).classList.add('active');
+      if (event) event.currentTarget.classList.add('active');
+      if (pageId === 'calendar') renderCalendar();
+    };
+
+    const openModal = (id) => {
+      document.getElementById(id).classList.add('active');
+      document.body.classList.add('modal-open');
+    };
+
+    const closeModal = (id) => {
+      document.getElementById(id).classList.remove('active');
+      document.body.classList.remove('modal-open');
+      if (id === 'useModal') resetUseModal();
+      if (id === 'orderModal') resetOrderModal();
+      if (id === 'itemModal') {
+        clearItemModal();
+        document.querySelector('#itemModal .btn.primary').onclick = saveItem;
+      }
+    };
+
+    const resetUseModal = () => {
+      document.getElementById('useReason').value = '';
+      document.getElementById('suddenReason').value = '';
+      document.getElementById('useNote').value = '';
+      document.getElementById('suddenReasonArea').classList.add('hidden');
+    };
+
+    const resetOrderModal = () => {
+      document.getElementById('orderStatus').value = 'ä¾é ¼ä¸­';
+      document.getElementById('orderQty').value = '';
+      document.getElementById('orderDate').value = '';
+      document.getElementById('orderDue').value = '';
+      document.getElementById('orderNote').value = '';
+    };
+
+    const toggleSuddenReason = () => {
+      const reason = document.getElementById('useReason').value;
+      const area = document.getElementById('suddenReasonArea');
+      if (reason === 'çªç™ºäº¤æ›') {
+        area.classList.remove('hidden');
+      } else {
+        area.classList.add('hidden');
+        document.getElementById('suddenReason').value = '';
+      }
+    };
+
+    const setSuddenReason = (reason) => {
+      document.getElementById('suddenReason').value = reason;
+    };
+
+    const addToHistory = (key, value) => {
+      if (!value) return;
+      const arr = state.history[key];
+      if (!arr.includes(value)) arr.push(value);
+    };
+
+    const updateHistoryDatalist = () => {
+      const setOptions = (id, list) => {
+        document.getElementById(id).innerHTML = list.map(value => `<option value="${value}"></option>`).join('');
+      };
+      setOptions('history-name', state.history.names);
+      setOptions('history-maker', state.history.makers);
+      setOptions('history-model', state.history.models);
+      setOptions('history-category', state.history.categories);
+    };
+
+    const assignCategoryColor = (category) => {
+      if (!category) return '#94a3b8';
+      if (state.categoryColors[category]) return state.categoryColors[category];
+      const color = COLOR_PALETTE[Object.keys(state.categoryColors).length % COLOR_PALETTE.length];
+      state.categoryColors[category] = color;
+      return color;
+    };
+
+    const getCategoryList = () => {
+      const categories = state.items.filter(item => !item.deleted).map(item => item.category).filter(Boolean);
+      return [...new Set(categories)];
+    };
+
+    const renderCategoryFilters = () => {
+      const categories = getCategoryList();
+      const stockFilter = document.getElementById('stockCategoryFilter');
+      const historyFilter = document.getElementById('historyCategoryFilter');
+      const options = ['<option value="">å…¨ã‚«ãƒ†ã‚´ãƒª</option>'].concat(
+        categories.map(cat => `<option value="${cat}">${cat}</option>`)
+      );
+      stockFilter.innerHTML = options.join('');
+      historyFilter.innerHTML = options.join('');
+    };
+
+    const calculateTotalAsset = () => {
+      const total = state.items.filter(item => !item.deleted)
+        .reduce((sum, item) => sum + (item.stock * (item.price || 0)), 0);
+      document.getElementById('totalAsset').textContent = total.toLocaleString();
+    };
+
+    const getAlertClass = (item) => {
+      if (item.stock <= item.minStock) return 'alert-shortage';
+      if (item.orderRequest && item.orderRequest.status === 'ä¾é ¼ä¸­') return 'alert-order';
+      return '';
+    };
+
+    const renderShortageNotice = () => {
+      const shortage = state.items.filter(item => !item.deleted && item.stock <= item.minStock);
+      const container = document.getElementById('shortageNotice');
+      if (shortage.length === 0) {
+        container.innerHTML = '';
+        return;
+      }
+      container.innerHTML = `
+        <div class="card alert-shortage">
+          <div style="font-weight:700; color:var(--danger); margin-bottom:6px;">è³¼å…¥ä¾é ¼ã—ã¦ãã ã•ã„</div>
+          <div>${shortage.map(item => item.name).join(' / ')}</div>
+        </div>
+      `;
+    };
+
+    const renderStockList = () => {
+      const search = document.getElementById('stockSearch').value.trim().toLowerCase();
+      const category = document.getElementById('stockCategoryFilter').value;
+      const list = state.items.filter(item => !item.deleted).filter(item => {
+        const matchesSearch = item.name.toLowerCase().includes(search);
+        const matchesCategory = !category || item.category === category;
+        return matchesSearch && matchesCategory;
+      });
+
+      const container = document.getElementById('stockList');
+      container.innerHTML = list.map(item => {
+        const categoryColor = assignCategoryColor(item.category);
+        const alertClass = getAlertClass(item);
+        const orderInfo = item.orderRequest && item.orderRequest.status === 'ä¾é ¼ä¸­'
+          ? `<div class="muted">ç™ºæ³¨: ${item.orderRequest.qty || '-'} / ${item.orderRequest.orderDate || '-'} / ${item.orderRequest.expectedDate || '-'}</div>`
+          : '';
+        const shortageText = item.stock <= item.minStock ? '<div class="status-text" style="color:var(--danger);">è³¼å…¥ä¾é ¼ã—ã¦ãã ã•ã„</div>' : '';
+        const orderStatus = item.orderRequest
+          ? `<div class="status-text" style="color:${item.orderRequest.status === 'ä¾é ¼ä¸­' ? 'var(--warning)' : 'var(--success)'};">ç™ºæ³¨${item.orderRequest.status}</div>`
+          : '';
+        return `
+          <div class="card ${alertClass}">
+            <div class="row-between">
+              <div>
+                <span class="category-chip" style="background:${categoryColor};">${item.category || 'æœªåˆ†é¡'}</span>
+                <div class="muted">${item.maker} / ${item.model}</div>
+                <div style="font-size:18px; font-weight:700;">${item.name}</div>
+                ${orderStatus}
+                ${orderInfo}
+                ${shortageText}
+              </div>
+              <div style="text-align:right;">
+                <div style="font-size:26px; font-weight:700;">${item.stock}</div>
+                <div class="muted">Â¥${(item.stock * (item.price || 0)).toLocaleString()}</div>
+              </div>
+            </div>
+            <div class="row" style="margin-top:12px;">
+              <input id="qty-${item.id}" type="number" inputmode="numeric" class="input small" placeholder="æ•°é‡">
+              <button class="btn danger" onclick="openUseModal(${item.id})">ä½¿ç”¨</button>
+              <button class="btn success" onclick="receiveItem(${item.id})">ç´å…¥</button>
+              <button class="btn warning" onclick="openOrderModal(${item.id})">ç™ºæ³¨</button>
+            </div>
+          </div>
+        `;
+      }).join('');
+    };
+
+    const renderMasterList = () => {
+      const container = document.getElementById('masterList');
+      const list = state.items.filter(item => !item.deleted);
+      container.innerHTML = list.map(item => {
+        return `
+          <div class="card">
+            <div class="row-between">
+              <div>
+                <div style="font-weight:700;">${item.name}</div>
+                <div class="muted">ã‚³ãƒ¼ãƒ‰: ${item.code} / ${item.category}</div>
+                <div class="muted">æœ€ä½åœ¨åº«: ${item.minStock} / ç¾åœ¨åº«: ${item.stock}</div>
+                <div class="muted">äº¤æ›å‘¨æœŸ: ${item.cycleDays || '-'}æ—¥ / æœ€çµ‚æ£šå¸: ${item.lastInventoryDate || '-'}</div>
+              </div>
+              <div class="row" style="flex-direction:column;">
+                <button class="btn ghost" onclick="editItem('${item.id}')">ç·¨é›†</button>
+                <button class="btn ghost" onclick="deleteItem('${item.id}')" style="color:var(--danger);">å‰Šé™¤</button>
+              </div>
+            </div>
+          </div>
+        `;
+      }).join('');
+    };
+
+    const renderHistory = () => {
+      const search = document.getElementById('historySearch').value.trim().toLowerCase();
+      const category = document.getElementById('historyCategoryFilter').value;
+      const list = state.logs
+        .filter(log => !category || log.category === category)
+        .filter(log => (log.itemName || '').toLowerCase().includes(search))
+        .slice(0, 1000);
+
+      const tbody = document.getElementById('historyList');
+      tbody.innerHTML = list.map(log => `
+        <tr>
+          <td>${log.date}</td>
+          <td>${log.itemName}</td>
+          <td>${log.itemCode}</td>
+          <td>${log.category}</td>
+          <td>${log.type}</td>
+          <td>${log.qty}</td>
+          <td>${log.afterStock}</td>
+          <td>${log.useReason || '-'}</td>
+          <td>${log.suddenReason || '-'}</td>
+          <td><button class="btn ghost" onclick="openHistoryEdit('${log.id}')">ç·¨é›†</button></td>
+        </tr>
+      `).join('');
+    };
+
+    const openUseModal = (itemId) => {
+      const qty = document.getElementById(`qty-${itemId}`).value;
+      if (!qty || Number(qty) <= 0) {
+        alert('æ•°é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
+        return;
+      }
+      state.selectedItemId = itemId;
+      openModal('useModal');
+    };
+
+    const confirmUse = () => {
+      const reason = document.getElementById('useReason').value;
+      if (!reason) {
+        alert('ä½¿ç”¨ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„');
+        return;
+      }
+      const suddenReason = document.getElementById('suddenReason').value;
+      if (reason === 'çªç™ºäº¤æ›' && !suddenReason) {
+        alert('çªç™ºäº¤æ›ç†ç”±ã‚’é¸æŠã—ã¦ãã ã•ã„');
+        return;
+      }
+      const note = document.getElementById('useNote').value;
+      const qty = Number(document.getElementById(`qty-${state.selectedItemId}`).value);
+      updateStock(state.selectedItemId, -qty, 'ä½¿ç”¨', reason, suddenReason, note);
+      document.getElementById(`qty-${state.selectedItemId}`).value = '';
+      closeModal('useModal');
+    };
+
+    const receiveItem = (itemId) => {
+      const qty = Number(document.getElementById(`qty-${itemId}`).value);
+      if (!qty || qty <= 0) {
+        alert('æ•°é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
+        return;
+      }
+      updateStock(itemId, qty, 'ç´å…¥', '', '', '');
+      document.getElementById(`qty-${itemId}`).value = '';
+    };
+
+    const openOrderModal = (itemId) => {
+      state.selectedItemId = itemId;
+      const item = state.items.find(i => i.id === itemId);
+      if (item && item.orderRequest) {
+        document.getElementById('orderStatus').value = item.orderRequest.status;
+        document.getElementById('orderQty').value = item.orderRequest.qty || '';
+        document.getElementById('orderDate').value = item.orderRequest.orderDate || '';
+        document.getElementById('orderDue').value = item.orderRequest.expectedDate || '';
+        document.getElementById('orderNote').value = item.orderRequest.note || '';
+      }
+      openModal('orderModal');
+    };
+
+    const saveOrderRequest = () => {
+      const item = state.items.find(i => i.id === state.selectedItemId);
+      if (!item) return;
+      item.orderRequest = {
+        status: document.getElementById('orderStatus').value,
+        qty: Number(document.getElementById('orderQty').value) || 0,
+        orderDate: document.getElementById('orderDate').value,
+        expectedDate: document.getElementById('orderDue').value,
+        note: document.getElementById('orderNote').value
+      };
+      saveAll();
+      closeModal('orderModal');
+    };
+
+    const updateStock = (itemId, delta, type, useReason, suddenReason, note) => {
+      const item = state.items.find(i => i.id === itemId);
+      if (!item) return;
+      item.stock = Math.max(0, item.stock + delta);
+      const now = new Date();
+      const log = {
+        id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,
+        timestamp: now.getTime(),
+        date: now.toLocaleString('ja-JP'),
+        itemCode: item.code,
+        itemName: item.name,
+        category: item.category,
+        type,
+        qty: Math.abs(delta),
+        afterStock: item.stock,
+        useReason,
+        suddenReason,
+        note,
+        editedAt: ''
+      };
+      state.logs.unshift(log);
+      if (type === 'ä½¿ç”¨') item.lastUseDate = now.toISOString().slice(0, 10);
+      saveAll();
+    };
+
+    const saveItem = () => {
+      const code = document.getElementById('itemCode').value.trim();
+      if (!code) return alert('å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™');
+      const exists = state.items.find(item => item.code === code && !item.deleted);
+      if (exists) return alert('å•†å“ã‚³ãƒ¼ãƒ‰ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');
+
+      const item = {
+        id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,
+        code,
+        name: document.getElementById('itemName').value.trim(),
+        maker: document.getElementById('itemMaker').value.trim(),
+        model: document.getElementById('itemModel').value.trim(),
+        category: document.getElementById('itemCategory').value.trim(),
+        minStock: Number(document.getElementById('itemMin').value) || 0,
+        stock: Number(document.getElementById('itemStock').value) || 0,
+        baseStock: Number(document.getElementById('itemStock').value) || 0,
+        price: Number(document.getElementById('itemPrice').value) || 0,
+        leadTime: Number(document.getElementById('itemLead').value) || 0,
+        cycleDays: Number(document.getElementById('itemCycle').value) || 0,
+        notes: document.getElementById('itemNotes').value.trim(),
+        deleted: false,
+        orderRequest: null,
+        lastInventoryDate: '',
+        lastUseDate: ''
+      };
+
+      addToHistory('names', item.name);
+      addToHistory('makers', item.maker);
+      addToHistory('models', item.model);
+      addToHistory('categories', item.category);
+      assignCategoryColor(item.category);
+
+      state.items.push(item);
+      clearItemModal();
+      saveAll();
+      closeModal('itemModal');
+    };
+
+    const clearItemModal = () => {
+      ['itemCode','itemName','itemMaker','itemModel','itemCategory','itemMin','itemStock','itemPrice','itemLead','itemCycle','itemNotes']
+        .forEach(id => { document.getElementById(id).value = ''; });
+    };
+
+    const editItem = (itemId) => {
+      const item = state.items.find(i => i.id === itemId);
+      if (!item) return;
+      document.getElementById('itemCode').value = item.code;
+      document.getElementById('itemName').value = item.name;
+      document.getElementById('itemMaker').value = item.maker;
+      document.getElementById('itemModel').value = item.model;
+      document.getElementById('itemCategory').value = item.category;
+      document.getElementById('itemMin').value = item.minStock;
+      document.getElementById('itemStock').value = item.stock;
+      document.getElementById('itemPrice').value = item.price;
+      document.getElementById('itemLead').value = item.leadTime;
+      document.getElementById('itemCycle').value = item.cycleDays;
+      document.getElementById('itemNotes').value = item.notes;
+      openModal('itemModal');
+
+      const saveButton = document.querySelector('#itemModal .btn.primary');
+      saveButton.onclick = () => {
+        const newCode = document.getElementById('itemCode').value.trim();
+        if (!newCode) return alert('å•†å“ã‚³ãƒ¼ãƒ‰ã¯å¿…é ˆã§ã™');
+        if (newCode !== item.code && state.items.find(other => other.code === newCode && !other.deleted)) {
+          return alert('å•†å“ã‚³ãƒ¼ãƒ‰ãŒé‡è¤‡ã—ã¦ã„ã¾ã™');
+        }
+        item.code = newCode;
+        item.name = document.getElementById('itemName').value.trim();
+        item.maker = document.getElementById('itemMaker').value.trim();
+        item.model = document.getElementById('itemModel').value.trim();
+        item.category = document.getElementById('itemCategory').value.trim();
+        item.minStock = Number(document.getElementById('itemMin').value) || 0;
+        item.stock = Number(document.getElementById('itemStock').value) || 0;
+        item.baseStock = item.stock;
+        item.price = Number(document.getElementById('itemPrice').value) || 0;
+        item.leadTime = Number(document.getElementById('itemLead').value) || 0;
+        item.cycleDays = Number(document.getElementById('itemCycle').value) || 0;
+        item.notes = document.getElementById('itemNotes').value.trim();
+
+        addToHistory('names', item.name);
+        addToHistory('makers', item.maker);
+        addToHistory('models', item.model);
+        addToHistory('categories', item.category);
+        assignCategoryColor(item.category);
+
+        clearItemModal();
+        closeModal('itemModal');
+        saveAll();
+        document.querySelector('#itemModal .btn.primary').onclick = saveItem;
+      };
+    };
+
+    const deleteItem = (itemId) => {
+      const item = state.items.find(i => i.id === itemId);
+      if (!item) return;
+      if (!confirm('å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿï¼ˆè«–ç†å‰Šé™¤ï¼‰')) return;
+      item.deleted = true;
+      saveAll();
+    };
+
+    const openInventory = () => {
+      renderInventoryList();
+      openModal('inventoryModal');
+    };
+
+    const renderInventoryList = () => {
+      const sortBy = document.getElementById('inventorySort').value;
+      const items = state.items.filter(item => !item.deleted);
+      items.sort((a, b) => {
+        if (sortBy === 'category') {
+          return (a.category || '').localeCompare(b.category || '') || a.name.localeCompare(b.name);
+        }
+        return a.name.localeCompare(b.name);
+      });
+      const container = document.getElementById('inventoryList');
+      container.innerHTML = items.map(item => {
+        const draftValue = state.inventoryDraft[item.id];
+        const value = draftValue !== undefined ? draftValue : item.stock;
+        return `
+          <div class="card">
+            <div class="inventory-row">
+              <div>
+                <div style="font-weight:700;">${item.name}</div>
+                <div class="muted">${item.category} / ç¾åœ¨åº«: ${item.stock}</div>
+              </div>
+              <input class="input small" type="number" inputmode="numeric" value="${value}" onchange="updateInventoryDraft('${item.id}', this.value)">
+            </div>
+          </div>
+        `;
+      }).join('');
+    };
+
+    const updateInventoryDraft = (itemId, value) => {
+      state.inventoryDraft[itemId] = Number(value) || 0;
+      saveState();
+    };
+
+    const confirmInventory = () => {
+      const now = new Date();
+      state.items.filter(item => !item.deleted).forEach(item => {
+        const newValue = state.inventoryDraft[item.id];
+        if (newValue === undefined) return;
+        if (item.stock !== newValue) {
+          item.stock = newValue;
+          item.lastInventoryDate = now.toISOString().slice(0, 10);
+          const log = {
+            id: `log-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,
+            timestamp: now.getTime(),
+            date: now.toLocaleString('ja-JP'),
+            itemCode: item.code,
+            itemName: item.name,
+            category: item.category,
+            type: 'æ£šå¸',
+            qty: newValue,
+            afterStock: newValue,
+            useReason: '',
+            suddenReason: '',
+            note: 'æ£šå¸ç¢ºå®š',
+            editedAt: ''
+          };
+          state.logs.unshift(log);
+        }
+      });
+      state.inventoryDraft = {};
+      saveAll();
+      closeModal('inventoryModal');
+      alert('æ£šå¸ã‚’ç¢ºå®šã—ã¾ã—ãŸ');
+    };
+
+    const openHistoryEdit = (logId) => {
+      const log = state.logs.find(l => l.id === logId);
+      if (!log) return;
+      state.selectedLogId = logId;
+      document.getElementById('editType').value = log.type;
+      document.getElementById('editQty').value = log.qty;
+      document.getElementById('editAfter').value = log.afterStock;
+      document.getElementById('editReason').value = log.useReason || '';
+      document.getElementById('editSudden').value = log.suddenReason || '';
+      document.getElementById('editNote').value = log.note || '';
+      openModal('historyEditModal');
+    };
+
+    const saveHistoryEdit = () => {
+      const log = state.logs.find(l => l.id === state.selectedLogId);
+      if (!log) return;
+      log.type = document.getElementById('editType').value;
+      log.qty = Number(document.getElementById('editQty').value) || 0;
+      log.afterStock = Number(document.getElementById('editAfter').value) || 0;
+      log.useReason = document.getElementById('editReason').value;
+      log.suddenReason = document.getElementById('editSudden').value;
+      log.note = document.getElementById('editNote').value;
+      log.editedAt = new Date().toISOString();
+      recalcStocks();
+      saveAll();
+      closeModal('historyEditModal');
+    };
+
+    const recalcStocks = () => {
+      const itemsByCode = Object.fromEntries(state.items.map(item => [item.code, item]));
+      state.items.forEach(item => {
+        item.stock = item.baseStock || 0;
+        item.lastUseDate = '';
+      });
+      const logsAsc = [...state.logs].sort((a, b) => a.timestamp - b.timestamp);
+      logsAsc.forEach(log => {
+        const item = itemsByCode[log.itemCode];
+        if (!item || item.deleted) return;
+        if (log.type === 'ä½¿ç”¨') {
+          item.stock = Math.max(0, item.stock - log.qty);
+          item.lastUseDate = new Date(log.timestamp).toISOString().slice(0, 10);
+          log.afterStock = item.stock;
+        } else if (log.type === 'ç´å…¥') {
+          item.stock += log.qty;
+          log.afterStock = item.stock;
+        } else if (log.type === 'æ£šå¸' || log.type === 'ä¿®æ­£') {
+          item.stock = log.afterStock || log.qty;
+        }
+      });
+    };
+
+    const parseCSV = (text) => {
+      const rows = [];
+      let current = '';
+      let inQuotes = false;
+      let row = [];
+      for (let i = 0; i < text.length; i++) {
+        const char = text[i];
+        const next = text[i + 1];
+        if (char === '"' && next === '"') {
+          current += '"';
+          i++;
+        } else if (char === '"') {
+          inQuotes = !inQuotes;
+        } else if (char === ',' && !inQuotes) {
+          row.push(current);
+          current = '';
+        } else if ((char === '\n' || char === '\r') && !inQuotes) {
+          if (current || row.length) {
+            row.push(current);
+            rows.push(row);
+            row = [];
+            current = '';
+          }
+        } else {
+          current += char;
+        }
+      }
+      if (current || row.length) {
+        row.push(current);
+        rows.push(row);
+      }
+      return rows;
+    };
+
+    const exportItemsCSV = () => {
+      const headers = ['å•†å“ã‚³ãƒ¼ãƒ‰','å“å','ãƒ¡ãƒ¼ã‚«ãƒ¼','å‹å¼','ã‚«ãƒ†ã‚´ãƒªãƒ¼','æœ€ä½åœ¨åº«æ•°','ç¾åœ¨åº«æ•°','é‡‘é¡','ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ','äº¤æ›å‘¨æœŸ','å‚™è€ƒ'];
+      const rows = state.items.filter(item => !item.deleted).map(item => [
+        item.code, item.name, item.maker, item.model, item.category, item.minStock, item.stock, item.price, item.leadTime, item.cycleDays, item.notes
+      ]);
+      downloadCSV('items.csv', [headers, ...rows]);
+    };
+
+    const exportHistoryCSV = () => {
+      const headers = ['æ—¥æ™‚','å•†å“ã‚³ãƒ¼ãƒ‰','å•†å“å','ã‚«ãƒ†ã‚´ãƒªãƒ¼','æ“ä½œç¨®åˆ¥','æ•°é‡','æ“ä½œå¾Œåœ¨åº«æ•°','ä½¿ç”¨ç†ç”±','çªç™ºäº¤æ›ç†ç”±'];
+      const rows = state.logs.map(log => [
+        log.date, log.itemCode, log.itemName, log.category, log.type, log.qty, log.afterStock, log.useReason, log.suddenReason
+      ]);
+      downloadCSV('history.csv', [headers, ...rows]);
+    };
+
+    const downloadCSV = (filename, rows) => {
+      const csv = rows.map(row => row.map(value => {
+        const str = value === undefined ? '' : String(value);
+        if (str.includes(',') || str.includes('"') || str.includes('\n')) {
+          return `"${str.replace(/"/g, '""')}"`;
+        }
+        return str;
+      }).join(',')).join('\n');
+      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
+      const link = document.createElement('a');
+      link.href = URL.createObjectURL(blob);
+      link.download = filename;
+      link.click();
+      URL.revokeObjectURL(link.href);
+    };
+
+    const importItemsCSV = async (event) => {
+      const file = event.target.files[0];
+      if (!file) return;
+      const text = await file.text();
+      const rows = parseCSV(text);
+      if (rows.length <= 1) return;
+      const headers = rows[0];
+      const dataRows = rows.slice(1);
+      dataRows.forEach(row => {
+        const record = {};
+        headers.forEach((header, index) => {
+          record[header] = row[index] || '';
+        });
+        if (!record['å•†å“ã‚³ãƒ¼ãƒ‰']) return;
+        const existing = state.items.find(item => item.code === record['å•†å“ã‚³ãƒ¼ãƒ‰']);
+        const payload = {
+          code: record['å•†å“ã‚³ãƒ¼ãƒ‰'],
+          name: record['å“å'] || '',
+          maker: record['ãƒ¡ãƒ¼ã‚«ãƒ¼'] || '',
+          model: record['å‹å¼'] || '',
+          category: record['ã‚«ãƒ†ã‚´ãƒªãƒ¼'] || '',
+          minStock: Number(record['æœ€ä½åœ¨åº«æ•°']) || 0,
+          stock: Number(record['ç¾åœ¨åº«æ•°']) || 0,
+          price: Number(record['é‡‘é¡']) || 0,
+          leadTime: Number(record['ãƒªãƒ¼ãƒ‰ã‚¿ã‚¤ãƒ ']) || 0,
+          cycleDays: Number(record['äº¤æ›å‘¨æœŸ']) || 0,
+          notes: record['å‚™è€ƒ'] || ''
+        };
+        if (existing) {
+          Object.assign(existing, payload);
+          existing.baseStock = existing.stock;
+          existing.deleted = false;
+        } else {
+          state.items.push({
+            id: `item-${Date.now()}-${Math.random().toString(36).slice(2, 6)}`,
+            baseStock: payload.stock,
+            orderRequest: null,
+            lastInventoryDate: '',
+            lastUseDate: '',
+            deleted: false,
+            ...payload
+          });
+        }
+        addToHistory('names', payload.name);
+        addToHistory('makers', payload.maker);
+        addToHistory('models', payload.model);
+        addToHistory('categories', payload.category);
+        assignCategoryColor(payload.category);
+      });
+      saveAll();
+      event.target.value = '';
+      alert('ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ');
+    };
+
+    const renderCalendar = () => {
+      const month = state.calendarMonth;
+      const year = month.getFullYear();
+      const monthIndex = month.getMonth();
+      document.getElementById('calendarTitle').textContent = `${year}å¹´${monthIndex + 1}æœˆ`;
+
+      const firstDay = new Date(year, monthIndex, 1);
+      const lastDay = new Date(year, monthIndex + 1, 0);
+      const startWeek = firstDay.getDay();
+      const totalDays = lastDay.getDate();
+
+      const scheduleMap = buildExchangeSchedule();
+      const calendarGrid = document.getElementById('calendarGrid');
+      calendarGrid.innerHTML = '';
+
+      const headers = ['æ—¥','æœˆ','ç«','æ°´','æœ¨','é‡‘','åœŸ'];
+      headers.forEach(day => {
+        const div = document.createElement('div');
+        div.className = 'day-header';
+        div.textContent = day;
+        calendarGrid.appendChild(div);
+      });
+
+      for (let i = 0; i < startWeek; i++) {
+        const empty = document.createElement('div');
+        calendarGrid.appendChild(empty);
+      }
+
+      for (let day = 1; day <= totalDays; day++) {
+        const dateKey = formatDateKey(year, monthIndex, day);
+        const hasEvent = scheduleMap[dateKey];
+        const cell = document.createElement('button');
+        cell.className = `day${hasEvent ? ' has-event' : ''}`;
+        cell.textContent = day;
+        cell.onclick = () => selectDate(dateKey);
+        cell.dataset.date = dateKey;
+        calendarGrid.appendChild(cell);
+      }
+
+      const today = new Date();
+      const todayKey = today.toISOString().slice(0, 10);
+      const withinMonth = today.getFullYear() === year && today.getMonth() === monthIndex;
+      selectDate(withinMonth ? todayKey : formatDateKey(year, monthIndex, 1));
+    };
+
+    const changeMonth = (delta) => {
+      state.calendarMonth = new Date(state.calendarMonth.getFullYear(), state.calendarMonth.getMonth() + delta, 1);
+      renderCalendar();
+    };
+
+    const formatDateKey = (year, monthIndex, day) => {
+      const month = String(monthIndex + 1).padStart(2, '0');
+      const date = String(day).padStart(2, '0');
+      return `${year}-${month}-${date}`;
+    };
+
+    const selectDate = (dateKey) => {
+      document.querySelectorAll('.calendar .day').forEach(cell => {
+        cell.classList.toggle('selected', cell.dataset.date === dateKey);
+      });
+      const scheduleMap = buildExchangeSchedule();
+      const list = scheduleMap[dateKey] || [];
+      const container = document.getElementById('exchangeList');
+      if (list.length === 0) {
+        container.textContent = 'è©²å½“ã™ã‚‹äº¤æ›äºˆå®šã¯ã‚ã‚Šã¾ã›ã‚“ã€‚';
+        return;
+      }
+      container.innerHTML = list.map(item => `<div class="list-item"><strong>${item.name}</strong><div class="muted">ã‚«ãƒ†ã‚´ãƒª: ${item.category} / æ¬¡å›äº¤æ›æ—¥: ${item.nextDate}</div></div>`).join('');
+    };
+
+    const buildExchangeSchedule = () => {
+      const scheduleMap = {};
+      const items = state.items.filter(item => !item.deleted && item.cycleDays > 0);
+      items.forEach(item => {
+        const lastUse = getLastUseDate(item.code);
+        if (!lastUse) return;
+        const nextDate = addBusinessDays(new Date(lastUse), item.cycleDays);
+        const dateKey = nextDate.toISOString().slice(0, 10);
+        if (!scheduleMap[dateKey]) scheduleMap[dateKey] = [];
+        scheduleMap[dateKey].push({
+          name: item.name,
+          category: item.category,
+          nextDate: dateKey
+        });
+      });
+      return scheduleMap;
+    };
+
+    const getLastUseDate = (code) => {
+      const log = state.logs.find(l => l.itemCode === code && l.type === 'ä½¿ç”¨');
+      return log ? new Date(log.timestamp).toISOString().slice(0, 10) : null;
+    };
+
+    const addBusinessDays = (date, days) => {
+      const result = new Date(date);
+      let added = 0;
+      while (added < days) {
+        result.setDate(result.getDate() + 1);
+        const day = result.getDay();
+        if (day !== 0 && day !== 6) added++;
+      }
+      return result;
+    };
+
+    const saveAll = () => {
+      state.logs = state.logs.slice(0, 1000);
+      saveState();
+      updateHistoryDatalist();
+      renderCategoryFilters();
+      calculateTotalAsset();
+      renderShortageNotice();
+      renderStockList();
+      renderHistory();
+      renderMasterList();
+      renderCalendar();
+    };
+
+    const init = () => {
+      loadState();
+      updateHistoryDatalist();
+      renderCategoryFilters();
+      calculateTotalAsset();
+      renderShortageNotice();
+      renderStockList();
+      renderHistory();
+      renderMasterList();
+      renderCalendar();
+    };
+
+    init();
+  </script>
+</body>
+</html>
